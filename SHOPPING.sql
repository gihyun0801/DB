CREATE TABLE CATEGORIES(    

   CATRGORY_ID NUMBER PRIMARY KEY,
   CATEGORY_NAME VARCHAR2(100) UNIQUE

); 

INSERT INTO CATEGORIES 
VALUES(1, '스마트폰');

INSERT INTO CATEGORIES
VALUES(2, 'TV');

INSERT INTO CATEGORIES
VALUES(3, 'Gaming');



CREATE TABLE PRODUCTS( 

   PRODUCT_ID NUMBER PRIMARY KEY,
   PRODUCT_NAME VARCHAR2(100) NOT NULL,
   CATEGORY NUMBER,
   PRICE NUMBER DEFAULT 0,
   STOCK_QUANTITY NUMBER DEFAULT 0,
   
   CONSTRAINT CATEGORYS FOREIGN KEY(CATEGORY) REFERENCES CATEGORIES

);

SELECT ORDER_ID , PRODUCT_NAME, QUANTITY ,PRICE, PRICE * QUANTITY
FROM PRODUCTS
JOIN ORDER_DETAILS USING(PRODUCT_ID)
JOIN ORDERS USING(ORDER_ID)
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE NAME = '유관순'
ORDER BY 1 , 3;



INSERT INTO PRODUCTS
VALUES(101, 'Apple iPhone 12', 1, 1500000, 30);
INSERT INTO PRODUCTS
VALUES(102, 'Samsung Galaxy S24', 1, 1800000, 50);
INSERT INTO PRODUCTS
VALUES(201, 'LG OLED TV', 2, 3600000, 10);
INSERT INTO PRODUCTS
VALUES(301, 'Sony PlayStation 5', 3, 700000, 15);

SELECT * FROM PRODUCTS;


CREATE TABLE CUSTOMERS( 
  
    CUSTOMER_ID NUMBER PRIMARY KEY,
    NAME VARCHAR2(20) NOT NULL,
    GENDER CHAR(3),
    ADDRESS VARCHAR2(100),
    PHONE VARCHAR2(30),
    
    CONSTRAINT GENDER_CHECK CHECK( GENDER IN('남','여')  )
  
); 

SELECT NAME, ORDER_DATE, STATUS
FROM CUSTOMERS
JOIN ORDERS USING(CUSTOMER_ID)
WHERE STATUS = 'N';

SELECT * FROM CUSTOMERS;


INSERT INTO CUSTOMERS
VALUES(1,'홍길동','남','서울시 성동구 왕십리','010-1111-2222');
INSERT INTO CUSTOMERS
VALUES(2,'유관순','여','서울시 종로구 안국동','010-3333-1111');

SELECT * FROM CUSTOMERS;



CREATE TABLE ORDERS(   
   
   ORDER_ID NUMBER PRIMARY KEY,
   CUSTOMER_ID NUMBER,
   ORDER_DATE DATE DEFAULT SYSDATE,
   STATUS CHAR(1),
   
   CONSTRAINT STATUS_CHECK CHECK( STATUS IN('Y','N')  ),
   CONSTRAINT CUSTOMER_ID_CHECK FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMERS ON DELETE CASCADE

); 

SELECT ORDER_ID , ORDER_DATE, STATUS
FROM CUSTOMERS E1
JOIN ORDERS USING(CUSTOMER_ID)
WHERE E1.NAME = '홍길동';




INSERT INTO ORDERS
VALUES(576, 1, '2024-03-11', 'N');

INSERT INTO ORDERS
VALUES(978, 2, '2024-03-11', 'Y');
INSERT INTO ORDERS
VALUES(777, 2, '2024-03-11', 'N');
INSERT INTO ORDERS
VALUES(134, 1, '2022-12-25', 'Y');
INSERT INTO ORDERS
VALUES(499, 1, '2020-01-03', 'Y');


SELECT * FROM ORDERS;

CREATE TABLE ORDER_DETAILS(   
   
    ORDER_DETAIL_ID NUMBER PRIMARY KEY,
    ORDER_ID NUMBER,
    PRODUCT_ID NUMBER,
    QUANTITY NUMBER,
    PRICE_PER_UNIT NUMBER,
    
    CONSTRAINT ORDER_ID_CHECK FOREIGN KEY(ORDER_ID) REFERENCES ORDERS ON DELETE CASCADE,
    CONSTRAINT PRODUCT_ID_CHECK FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCTS ON DELETE SET NULL


);

SELECT ORDER_ID , ORDER_DATE, STATUS
FROM ORDER_DETAILS
JOIN ORDERS USING(ORDER_ID)
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE NAME = '홍길동' AND 
EXTRACT(YEAR FROM ORDER_DATE) =  EXTRACT(YEAR FROM SYSDATE);



INSERT INTO ORDER_DETAILS
VALUES(111, 576, 101, 1, 1500000);

INSERT INTO ORDER_DETAILS
VALUES(222, 978, 201, 2, 3600000);

INSERT INTO ORDER_DETAILS
VALUES(333, 978, 102, 1, 1800000);

INSERT INTO ORDER_DETAILS
VALUES(444, 777, 301, 5, 700000);

INSERT INTO ORDER_DETAILS
VALUES(555, 134, 102, 1, 1800000);

INSERT INTO ORDER_DETAILS
VALUES(666, 499, 201, 3, 3600000);

SELECT * FROM ORDER_DETAILS;












